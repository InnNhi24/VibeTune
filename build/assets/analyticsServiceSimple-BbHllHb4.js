class g{static STORAGE_KEY="vibetune_analytics_simple";static MAX_EVENTS=1e3;static initialize(){try{console.log("✅ Analytics ready (localStorage)"),typeof window<"u"&&setTimeout(()=>{this.cleanupOldEvents().catch(console.warn)},1e4)}catch(t){console.warn("⚠️ Analytics init failed (non-critical):",t)}}static track(t,e={},s){try{const o={event_type:t,metadata:{...e,timestamp:Date.now(),user_agent:typeof navigator<"u"?navigator.userAgent:"unknown",url:typeof window<"u"?window.location.href:"unknown"},profile_id:s,created_at:new Date().toISOString(),timestamp:Date.now()};this.storeEvent(o),console.log(`Analytics tracked: ${t}`,e)}catch(o){console.warn("Failed to track analytics event:",o)}}static storeEvent(t){try{if(typeof window>"u"||!localStorage)return;const e=localStorage.getItem(this.STORAGE_KEY),s=e?JSON.parse(e):[];s.push(t),s.length>this.MAX_EVENTS&&s.splice(0,s.length-this.MAX_EVENTS),localStorage.setItem(this.STORAGE_KEY,JSON.stringify(s))}catch(e){console.warn("Failed to store analytics event:",e)}}static getStoredEvents(){try{if(typeof window>"u"||!localStorage)return[];const t=localStorage.getItem(this.STORAGE_KEY);return t?JSON.parse(t):[]}catch(t){return console.warn("Failed to get stored analytics events:",t),[]}}static cleanupOldEvents(){try{if(typeof window>"u"||!localStorage)return;const t=this.getStoredEvents(),e=Date.now()-720*60*60*1e3,s=t.filter(o=>o.timestamp>e);s.length!==t.length&&(localStorage.setItem(this.STORAGE_KEY,JSON.stringify(s)),console.log(`Cleaned up ${t.length-s.length} old analytics events`))}catch(t){console.warn("Failed to cleanup old analytics events:",t)}}static getUserAnalytics(t,e=7){try{const s=this.getStoredEvents(),o=Date.now()-e*24*60*60*1e3,d=s.filter(a=>a.profile_id===t&&a.timestamp>o),n={total_events:d.length,session_count:0,practice_sessions:0,placement_tests:0,avg_prosody_score:0,most_active_topics:[],daily_activity:{}},p=new Set,r=[],i={},l={};return d.forEach(a=>{const c=new Date(a.created_at).toISOString().split("T")[0];l[c]=(l[c]||0)+1,a.metadata?.sessionId&&p.add(a.metadata.sessionId),a.event_type==="practice_session_completed"&&n.practice_sessions++,a.event_type==="placement_test_completed"&&n.placement_tests++,a.metadata?.prosodyScore&&r.push(a.metadata.prosodyScore),a.metadata?.topic&&(i[a.metadata.topic]=(i[a.metadata.topic]||0)+1)}),n.session_count=p.size,n.avg_prosody_score=r.length>0?Math.round(r.reduce((a,c)=>a+c,0)/r.length):0,n.most_active_topics=Object.entries(i).sort(([,a],[,c])=>c-a).slice(0,5).map(([a])=>a),n.daily_activity=l,{data:n,error:null}}catch(s){return console.error("Failed to get user analytics:",s),{data:null,error:s}}}static trackPageView(t,e={}){this.track("page_view",{page:t,...e})}static trackUserAction(t,e={}){this.track("user_action",{action:t,...e})}static trackPracticeSession(t){this.track("practice_session_completed",t)}static trackPlacementTest(t){this.track("placement_test_completed",t)}static trackError(t,e={}){this.track("error",{error:t,...e})}static trackPerformance(t,e,s={}){this.track("performance_metric",{metric:t,value:e,...s})}static clearAllEvents(){try{typeof window<"u"&&localStorage&&(localStorage.removeItem(this.STORAGE_KEY),console.log("All analytics events cleared"))}catch(t){console.warn("Failed to clear analytics events:",t)}}static exportEvents(){try{const t=this.getStoredEvents();return console.log("Analytics Events Export:",t),t}catch(t){return console.warn("Failed to export analytics events:",t),[]}}}export{g as AnalyticsService,g as SimpleAnalyticsService};
